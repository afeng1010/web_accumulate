## 小程序再次获取权限

> 这半年来一直在开发小程序，也遇见了一些大大小小的问题，这次我就说一下自己怎么处理这个再次获取权限问题吧。

### 问题分析：

用户拒绝授权后，就调不起授权框了


### 原理：

每次调用需要用户授权的 API 时，就先调用 wx.authorize API ，如果用户拒绝授权就会执行 fail 回调函数，所以会显示弹窗，点击了确认，就会执行 wx.openSetting API ，就会跳转到授权页面。如果用户有授权，wx.authorize API 就会执行 success 回调函数。授权是有缓存的，所以在真机里测试授权问题时，记得去小程序设置那里设置。


### 解决办法：
```js
wx.authorize({
  scope: 'scope.userLocation',
  success: () => {
    wx.chooseLocation({
      success: res => {}
    });
  },
  fail: () => {
    wx.showModal({
      content: '检测到您没打开权限，是否去设置打开？',
      confirmText: "确认",
      cancelText: "取消", 
      success: res => {
          if(res.confirm) {
              wx.openSetting({
                  success: () => {}
              });
          }
      }
    });
  }
});
```
